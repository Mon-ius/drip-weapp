{"version":3,"sources":["app.js"],"names":["wechat","require","App","globalData","version","apiHost","userInfo","getUserInfo","cb","that","console","log","wx","login","success","res","code","param","provider","request","url","data","method","POST","header","status","user","email","token","showToast","title","errMsg","duration","fail","onLaunch","onShow","onHide"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * WeChat API 模块\n * @type {Object}\n * 用于将微信官方`API`封装为`Promise`方式\n * > 小程序支持以`CommonJS`规范组织代码结构\n */\nconst wechat = require('./utils/wechat.js')\n// const baidu = require('./utils/baidu.js')\n\n\nApp({\n  /**\n   * Global shared\n   * 可以定义任何成员，用于在整个应用中共享\n   */\n  globalData: {\n    version: '0.1.0',\n    apiHost:'https://www.keepdays.com/index.php/api/',\n    userInfo: null\n  },\n\n  /**\n   * WeChat API\n   */\n  wechat: wechat,\n\n  /**\n   * WeChat API\n   */\n  /**\n   * 生命周期函数--监听小程序初始化\n   * 当小程序初始化完成时，会触发 onLaunch（全局只触发一次）\n   */\n   getUserInfo:function(cb){\n    var that = this;\n    console.log(this.globalData.userInfo);\n    if(this.globalData.userInfo){\n      typeof cb == \"function\" && cb(this.globalData.userInfo)\n    }else{\n      //调用登录接口\n      wx.login({\n        success: function (res) {\n          if(res.code) {\n            wx.getUserInfo({\n              success: function (res) {\n                var param = {};\n\n                param = res.userInfo;\n                param.provider = 'weapp';\n\n                that.globalData.userInfo = res.userInfo;\n                typeof cb == \"function\" && cb(that.globalData.userInfo)\n\n                wx.request({\n                  url:  that.globalData.apiHost+\"auth/oauth\", //仅为示例，并非真实的接口地址\n                  data: param,\n                  method: POST,\n                  header: {\n                    'content-type': 'application/json'\n                  },\n                  success: function(res) {\n                    if(res.data.status) {\n                       if(res.data.user.email) {\n                         that.globalData.userInfo.token = res.data.token;\n                       }\n                    }\n                    console.log(res.data)\n                  }\n                })\n              }\n            });\n          } else {\n            wx.showToast({\n              title: '登录失败:'+res.errMsg,\n              duration: 3000\n            });\n          }\n        },\n        fail: function(res) {\n          wx.showToast({\n            title: '登录失败:'+res.errMsg,\n            duration: 3000\n          });\n        }\n      });\n    }\n  },\n  onLaunch () {\n    var that = this;\n    if(this.globalData.userInfo){\n      typeof cb == \"function\" && cb(this.globalData.userInfo)\n    }else {\n      //调用登录接口\n      wx.login({\n        success: function (res) {\n          if (res.code) {\n            wx.getUserInfo({\n              success: function (res) {\n                var param = {};\n\n                param = res.userInfo;\n                param.provider = 'weapp';\n\n                that.globalData.userInfo = res.userInfo;\n                typeof cb == \"function\" && cb(that.globalData.userInfo)\n\n                wx.request({\n                  url: that.globalData.apiHost + \"auth/oauth\", //仅为示例，并非真实的接口地址\n                  data: param,\n                  method: \"POST\",\n                  header: {\n                    'content-type': 'application/json'\n                  },\n                  success: function (res) {\n                    if (res.data.status) {\n                      if (res.data.user.email) {\n                        that.globalData.userInfo.token = res.data.token;\n                      }\n                    }\n                    console.log(res.data)\n                  }\n                })\n              }\n            });\n          } else {\n            wx.showToast({\n              title: '登录失败:' + res.errMsg,\n              duration: 3000\n            });\n          }\n        },\n        fail: function (res) {\n          wx.showToast({\n            title: '登录失败:' + res.errMsg,\n            duration: 3000\n          });\n        }\n      });\n      // wechat.getLocation()\n      //   .then(res => {\n      //     const { latitude, longitude } = res\n      //     // return baidu.getCityName(latitude, longitude)\n      //   })\n      //   .then(name => {\n      //     // this.data.currentCity = name.replace('市', '')\n      //     // console.log(`currentCity : ${this.data.currentCity}`)\n      //   })\n      //   .catch(err => {\n      //     // this.data.currentCity = '北京'\n      //     // console.error(err)\n      //   })\n    }\n    console.log(' ========== Application is launched ========== ')\n  },\n  /**\n   * 生命周期函数--监听小程序显示\n   * 当小程序启动，或从后台进入前台显示，会触发 onShow\n   */\n  onShow () {\n    console.log(' ========== Application is showed ========== ')\n  },\n  /**\n   * 生命周期函数--监听小程序隐藏\n   * 当小程序从前台进入后台，会触发 onHide\n   */\n  onHide () {\n    console.log(' ========== Application is hid ========== ')\n  }\n})\n"]}